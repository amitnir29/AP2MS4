<!DOCTYPE html>
<html>
<head>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

    <!-- Latest Leaftlet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
          integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
          crossorigin="" />
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
            integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
            crossorigin=""></script>

    <meta charset="utf-8" />
    <title>AYR flights tracker</title>
    <link href="css/StyleSheet.css" rel="stylesheet" type="text/css" />

    <script src="js/flightsList/flightsList.js"></script>
    <script src="js/flightsList/flightListRowStyler.js"></script>
    <script src="js/flightsGetter.js"></script>
    <script src="js/flightEventHandler.js"></script>
    <script src="js/flightsList/flightListRowIdConverter.js"></script>
    <script src="js/ClientHandler.js"></script>
    <script src="js/flightsList/flightsDivisor.js"></script>
    <script src="js/flightWrapper.js"></script>
    <script src="js/ErrorHandler.js"></script>
    <script src="js/flightDetails.js"></script>
    <script src="js/map.js"></script>
</head>
<body>
    <table id="mainClass">
        <tr id="mapAndLists" style="height:80%">
            <td id="mapid">
                map
            </td>
            <td id="flightsLists">
                <!--Local flights list-->
                <div class="single-flights-list">
                    <div class="single-flights-list-head">
                        <table id="localFlightsHeads" class="table">
                            <thead>
                                <tr>
                                    <th scope="col" class="local-flight-data">
                                        Local Flights
                                    </th>
                                    <th scope="col" class="flight-delete">
                                        Delete Flight
                                    </th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                    <div class="single-flights-list-body">
                        <table id="localFlights" class="table">
                            <tbody class="single-flights-list-body">
                                <!--add here the flights-->
                            </tbody>
                        </table>
                    </div>
                </div>
                <!--External flights list-->
                <div class="single-flights-list">
                    <div class="single-flights-list-head">
                        <table id="externalFlightsHead" class="table">
                            <thead>
                                <tr>
                                    <th scope="col" class="local-flight-data">
                                        External Flights
                                    </th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                    <div class="single-flights-list-body">
                        <table id="externalFlights" class="table">
                            <tbody class="single-flights-list-body">
                                <!--add here the flights-->
                            </tbody>
                        </table>
                    </div>
                </div>
            </td>
        </tr>
        <tr id="detailsAndJson" style="height:20%">
            <td id="flightDetails">
                <p id="flightDetailsText"></p>
            </td>
            <td id="flightPlanJson">
                <div>
                    <form method="POST" action="uploadFile" id="jsonGetter">
                        <input type="file" class="custom-file-input" id="jsonFileInput" onchange="submitFile(this.files)">
                        <label class="custom-file-label" for="jsonFileInput">Choose JSON file</label>
                    </form>
                </div>
            </td>

        </tr>

    </table>


    <div id="error_list">
    </div>


    <!--code for the json input-->
    <script>
        function submitFile(files) {
            files = [...files];
            files.forEach(uploadFile);
        }
        function uploadFile(file) {
            let reader = new FileReader()
            reader.onload = function (e) {
                // The file's text will be printed here
                //document.write(e.target.result)
                //console.log(e.target.result)
                $.ajax({
                    url: "api/FlightPlan",
                    type: "post", //send it through get method
                    data: e.target.result,//the json file
                    contentType: "application/json",

                    success: function (data) {
                        //flightsArray = JSON.parse(data);
                        //consloe
                        //console.log("success in posting json");
                        //console.log(data);
                    },
                    error: function (xhr) {
                        ErrorHandler.showError("failed to post flightPlan to the server!")
                        //console.log("got to error in posting json");
                        //console.log(xhr);
                    }

                });
            };
            reader.readAsText(file)
        }
    </script>

    <!--call the start of the client-->
    <script>
        const c = new ClientHandler();
        //console.log("started client handler");
        c.startClient();
    </script>

</body>
</html>



